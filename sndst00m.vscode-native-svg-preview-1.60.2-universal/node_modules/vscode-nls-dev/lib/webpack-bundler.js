/* --------------------------------------------------------------------------------------------
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License. See License.txt in the project root for license information.
 * ------------------------------------------------------------------------------------------ */
'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.NLSBundlePlugin = void 0;
var lib_1 = require("./lib");
var NLSBundlePlugin = /** @class */ (function () {
    function NLSBundlePlugin(id) {
        this.id = id;
    }
    NLSBundlePlugin.prototype.apply = function (compiler) {
        var _this = this;
        compiler.hooks.emit.tap('NLSBundlePlugin', function (compilation) {
            var assets = {};
            var bundler = new lib_1.MetaDataBundler(_this.id, 'dist');
            for (var _i = 0, _a = Object.keys(compilation.assets); _i < _a.length; _i++) {
                var name = _a[_i];
                if (!/nls\.metadata\.json$/.test(name)) {
                    assets[name] = compilation.assets[name];
                    continue;
                }
                var json = JSON.parse(compilation.assets[name].source().toString('utf8'));
                bundler.add(json);
            }
            // Skip empty NLS files
            if (bundler.size === 0) {
                return;
            }
            var _b = bundler.bundle(), header = _b[0], content = _b[1];
            var rawHeader = JSON.stringify(header);
            var rawContent = JSON.stringify(content);
            assets['nls.metadata.header.json'] = {
                source: function () { return rawHeader; },
                size: function () { return rawHeader.length; }
            };
            assets['nls.metadata.json'] = {
                source: function () { return rawContent; },
                size: function () { return rawContent.length; }
            };
            compilation.assets = assets;
        });
    };
    return NLSBundlePlugin;
}());
exports.NLSBundlePlugin = NLSBundlePlugin;
//# sourceMappingURL=webpack-bundler.js.map